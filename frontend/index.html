<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar Warga (Frontend)</title>
    <style>
      /* CSS sama persis seperti sebelumnya */
      body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
      .container { max-width: 800px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
      h1 { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #e8f4fd; padding-bottom: 20px; }
      ul { margin-top: 20px; list-style: none; padding: 0; }
      .warga-item { background: #e8f4fd; margin-bottom: 12px; padding: 16px 20px; border-radius: 6px; box-shadow: 0 1px 2px rgba(0,0,0,0.04); display: flex; align-items: center; }
      .warga-link { color: #007bff; font-weight: bold; text-decoration: none; flex: 1; cursor: pointer; }
      .empty-message { background: #ffeaea; padding: 16px 20px; border-radius: 6px; color: #b30000; }
      a.action-link { display: inline-block; background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin-top: 10px; }
      a.action-link:hover { background-color: #0056b3; }
      hr { margin: 20px 0; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Daftar Warga</h1>
      
      <ul id="warga-list">
        <li>Sedang memuat data...</li>
      </ul>

      <div id="pagination-controls" style="text-align: center; margin-top: 20px;"></div>

      <br><hr>
      <a href="warga_form.html" class="action-link">Tambah Warga Baru</a>
      <br>
      <a href="pengaduan_form.html" class="action-link">Buat Pengaduan Baru</a>
      <br>
      <a href="pengaduan_list.html" class="action-link">Lihat Semua Pengaduan</a>
    </div>

    <script>
      // KONFIGURASI API
      let currentUrl = 'http://127.0.0.1:8000/api/warga/'; 

      // Fungsi untuk mengambil data dari Backend
      async function fetchWarga(url) {
        try {
          const response = await fetch(url);
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          renderWarga(data);
          
        } catch (error) {
          console.error('Ada masalah saat mengambil data:', error);
          document.getElementById('warga-list').innerHTML = `
            <li class="empty-message">
              Gagal mengambil data dari server. Pastikan backend menyala. <br>
              Error: ${error.message}
            </li>`;
        }
      }

      // Fungsi untuk menampilkan data ke HTML (DOM Manipulation)
      function renderWarga(response) {
        const listContainer = document.getElementById('warga-list');
        listContainer.innerHTML = ''; 

        // --- PERBAIKAN UTAMA DI SINI ---
        // Cek apakah response punya properti 'results' (artinya Pagination aktif)
        let dataList = [];
        
        if (Array.isArray(response)) {
            // Jika backend tidak pakai pagination (langsung array)
            dataList = response;
        } else if (response.results && Array.isArray(response.results)) {
            // Jika backend pakai pagination
            dataList = response.results;
            
            // Render Tombol Next/Prev (Bonus)
            renderPagination(response.next, response.previous);
        }
        // -------------------------------

        // Cek jika data kosong
        if (dataList.length === 0) {
          listContainer.innerHTML = `
            <li class="empty-message">
              Belum ada data warga yang terdaftar
            </li>`;
          return;
        }

        // Loop data
        dataList.forEach(warga => {
          const li = document.createElement('li');
          li.className = 'warga-item';
          
          li.innerHTML = `
            <a href="warga_detail.html?id=${warga.id}" class="warga-link">
              ${warga.nama_lengkap}
            </a>
          `;
          listContainer.appendChild(li);
        });
      }

      // Bonus: Fungsi navigasi Next/Prev
      function renderPagination(nextUrl, prevUrl) {
          const container = document.getElementById('pagination-controls');
          container.innerHTML = ''; // Reset

          if(prevUrl) {
              const btnPrev = document.createElement('button');
              btnPrev.innerText = '<< Sebelumnya';
              btnPrev.onclick = () => fetchWarga(prevUrl);
              btnPrev.style.marginRight = '10px';
              container.appendChild(btnPrev);
          }

          if(nextUrl) {
              const btnNext = document.createElement('button');
              btnNext.innerText = 'Selanjutnya >>';
              btnNext.onclick = () => fetchWarga(nextUrl);
              container.appendChild(btnNext);
          }
      }

      // Jalankan fungsi saat halaman dibuka
      fetchWarga(currentUrl);
    </script>
  </body>
</html>